 <%= form_for [ @user, @role], :html => { :class => 'form-horizontal' } do |f| %>
  <%= f.error_messages %>

  <div class="control-group">
    <%= f.label :unit_id, :class => 'control-label' %>
    <div class="controls">
      <%= f.select(:unit_id, Unit.where("units.parent_id = ? or units.id = ?", @user.unit_id, @user.unit_id).accessible_by(current_ability).map{|u| [u.name,u.id]}) %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :role, :class => 'control-label' %>
    <div class="controls">
      <% if current_user.unit.blank? or current_user.unit.unit_level == 1 %>
        <% if @user.deviceadmin? %>
          <%= f.select(:role, Role::ROLE1_SB.invert) %>
        <% elsif @user.accountant? %>
          <%= f.select(:role, Role::ROLE1_CW.invert) %>
        <% else %>
          <%= f.select(:role, Role::ROLE1.invert) %>
        <% end %>
      <% else %>
        <% if @user.deviceadmin? %>
          <%= f.select(:role, Role::ROLE2_SB.invert) %>
        <% elsif @user.accountant? %>
          <%= f.select(:role, Role::ROLE2_CW.invert) %>
        <% else %>
          <%= f.select(:role, Role::ROLE2.invert) %>
        <% end %>
      <% end %>
    </div>
  </div>


  <div class="form-actions">
    <%= f.submit nil, :class => 'btn btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                user_roles_path(@user), :class => 'btn' %>
  </div>
<% end %>